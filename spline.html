<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8"/>
	</head>
	<body>
		<script>
		 function makeDoubleDelegate(f1,f2) {
			 "use strict";
			 return function(){
				 if (f1) f1();
				 if (f2) f2();
			 }
		 }
		</script>

		<canvas id="splineCanvas" width="600" height="600"
			    style="border:1px solid black;">
			Canvas is not supported by your browser. WTF dude.
		</canvas>
		<script>
         var tau = 0.8;
         var spline = {
             controlPoints: [
                 {x: 0,y: 1},
                 {x: 1,y: 0},
                 {x: 0,y:-1},
                 {x:-1,y: 0},
                 {x: 0,y: 1},
                 {x: 1,y: 0},
                 {x: 0,y:-1}
             ],
             segments: [],
         };
         var iSeg,iSamp;
         for(iSeg=0; iSeg<spline.controlPoints.length-3; iSeg+=1) {
             var p0 = spline.controlPoints[iSeg+0];
             var p1 = spline.controlPoints[iSeg+1];
             var p2 = spline.controlPoints[iSeg+2];
             var p3 = spline.controlPoints[iSeg+3];
             var m = {
                 m00: p1.x,
                 m01: p1.y,
                 m02: 0,
                 m03: 0,
                 m10: (-tau)*p0.x + (tau)*p2.x,
                 m11: (-tau)*p0.y + (tau)*p2.y,
                 m12: 0,
                 m13: 0,
                 m20: (2*tau)*p0.x + (tau-3)*p1.x + (3-2*tau)*p2.x + (-tau)*p3.x,
                 m21: (2*tau)*p0.y + (tau-3)*p1.y + (3-2*tau)*p2.y + (-tau)*p3.y,
                 m22: 0,
                 m23: 0,
                 m30: (-tau)*p0.x + (2-tau)*p1.x + (tau-2)*p2.x + (tau)*p3.x,
                 m31: (-tau)*p0.y + (2-tau)*p1.y + (tau-2)*p2.y + (tau)*p3.y,
                 m32: 0,
                 m33: 0
             }
             spline.segments.push({
                 geomMatrix: m
             });
         }
		 var spinAngle = 0;
		 var timeStampPrevious;
		 function drawCanvasAnim(timeStamp) {
			 "use strict";
			 if (typeof timeStampPrevious === 'undefined')
				 timeStampPrevious = timeStamp;
			 var dtSec = (timeStamp - timeStampPrevious) * 0.001;
			 timeStampPrevious = timeStamp;
			 
			 var canvas = document.querySelector("#splineCanvas");
			 var ctx = canvas.getContext("2d");
             var iSeg,iSamp;
			 ctx.save();
			 ctx.clearRect(0,0, canvas.width, canvas.height);
             ctx.translate(canvas.width/2, canvas.height/2);
             ctx.scale(canvas.width/2, canvas.height/2);
             ctx.fillStyle = "red";
             ctx.strokeStyle = "red";
             ctx.lineWidth = 0.01;
             ctx.beginPath()
             for(iSeg=0; iSeg<spline.segments.length; iSeg+=1) {
                 var m = spline.segments[iSeg].geomMatrix;
                 for(iSamp=0; iSamp<=4; iSamp += 1) {
                     var u = iSamp / 4;
                     var x = ((m.m30*u + m.m20)*u + m.m10)*u + m.m00;
                     var y = ((m.m31*u + m.m21)*u + m.m11)*u + m.m01;
                     //ctx.fillRect(x,y,0.04,0.04);
                     ctx.lineTo(x,y);
                 }
             }
             ctx.stroke();
			 ctx.restore();
			 var requestId = requestAnimationFrame(drawCanvasAnim);
		 }
		 window.onload= makeDoubleDelegate(window.onload, function() {
			 "use strict";
			 var requestId = requestAnimationFrame(drawCanvasAnim);
		 });
		</script>
	</body>
</html>
